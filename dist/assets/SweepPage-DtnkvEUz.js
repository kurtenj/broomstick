import{j as e,R as z,I as P,b as R,T as A,C as F,d as L,P as B,O,e as U}from"./ui-components-cuZEfocq.js";import{r,g as $,u as M}from"./react-vendor-C6fyXXSt.js";import{c as v,B as j}from"./index-73v_QMnt.js";import{I as k}from"./input-CS8N0LOz.js";import{c as C,T as G}from"./trash-2-Coxujpny.js";import{R as N}from"./responsive-image-DThldyFT.js";import"./firebase-vendor-DhlEE7UM.js";import"./firebase-cMG96b0X.js";import{s as _,e as K,d as X,u as H,b as J}from"./sweepService-Bds68rhb.js";/**
 * @license lucide-react v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Q=C("Check",q);/**
 * @license lucide-react v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],W=C("X",V);function Y({className:t,...s}){return e.jsx(z,{"data-slot":"checkbox",className:v("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(P,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(Q,{className:"size-3.5"})})})}function Z({...t}){return e.jsx(R,{"data-slot":"dialog",...t})}function ee({...t}){return e.jsx(A,{"data-slot":"dialog-trigger",...t})}function te({...t}){return e.jsx(B,{"data-slot":"dialog-portal",...t})}function se({className:t,...s}){return e.jsx(O,{"data-slot":"dialog-overlay",className:v("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/80",t),...s})}const ae=r.forwardRef(({className:t,children:s,...a},n)=>e.jsxs(te,{children:[e.jsx(se,{}),e.jsxs(F,{ref:n,className:v("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),style:{backgroundColor:"hsl(var(--background))"},...a,children:[s,e.jsxs(L,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));function ne({className:t,...s}){return e.jsx(U,{"data-slot":"label",className:v("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}function re({item:t,onUpdate:s,onDelete:a}){const[n,m]=r.useState(t.text),[x,d]=r.useState(!1),i=c=>{s(t.id,{completed:c})},b=c=>{m(c.target.value)},f=()=>{n!==t.text&&s(t.id,{text:n})},p=()=>{a&&a(t.id)};return e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-md shadow-sm",style:{backgroundColor:"hsl(var(--background))"},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{id:`todo-${t.id}`,checked:t.completed,onCheckedChange:i,className:"size-4"}),e.jsx(ne,{htmlFor:`todo-${t.id}`,className:"sr-only",children:n||"Todo item"})]}),e.jsx("div",{className:"flex-1",children:e.jsx(k,{value:n,onChange:b,onBlur:f,className:v("h-9",t.completed&&"line-through text-muted-foreground")})}),t.screenshotUrl&&e.jsxs(Z,{open:x,onOpenChange:d,children:[e.jsx(ee,{asChild:!0,children:e.jsx("button",{className:"flex-shrink-0 size-9 flex items-center justify-center p-0 bg-transparent border rounded-md hover:bg-accent",children:e.jsx(N,{src:t.screenshotUrl,alt:"Screenshot",className:"object-cover rounded-sm",containerClassName:"size-8",priority:!0})})}),e.jsx(ae,{className:"max-w-3xl",children:e.jsx(N,{src:t.screenshotUrl,alt:"Screenshot",className:"w-full h-auto",sizes:"(max-width: 768px) 100vw, 90vw",priority:!0})})]}),a&&e.jsxs(j,{variant:"ghost",size:"icon",onClick:p,className:"size-9 text-muted-foreground hover:text-destructive",title:"Delete todo",children:[e.jsx(G,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]})}const oe=t=>{if(!t.clipboardData)return null;const{items:s}=t.clipboardData;if(!s)return null;for(let a=0;a<s.length;a++)if(s[a].type.indexOf("image")!==-1){const n=s[a].getAsFile();if(n){if(n.size>5*1024*1024)throw new Error("Image size exceeds 5MB limit");if(!["image/png","image/jpeg","image/gif"].includes(n.type))throw new Error("Unsupported image format. Please use PNG, JPEG, or GIF");return n}}return null};function ie({items:t,onAddItem:s,onUpdateItem:a,onDeleteItem:n}){const[m,x]=r.useState(""),[d,i]=r.useState(!1),[b,f]=r.useState(null),p=r.useRef(null);r.useEffect(()=>{p.current&&p.current.focus()},[]);const c=()=>{m.trim()&&(s(m),x(""))},y=l=>{l.key==="Enter"&&c()},w=async l=>{try{f(null);const h=oe(l.nativeEvent);h&&(i(!0),await s("",h),x(""))}catch(h){f(h instanceof Error?h.message:"Failed to process image")}finally{i(!1)}};return e.jsxs("div",{className:"space-y-6 w-full max-w-3xl mx-auto",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(k,{ref:p,placeholder:"Add a new todo item or paste a screenshot...",value:m,onChange:l=>x(l.target.value),onKeyDown:y,onPaste:w,disabled:d}),e.jsx(j,{onClick:c,disabled:!m.trim()||d,size:"default",children:"Add"})]}),b&&e.jsx("div",{className:"text-destructive text-sm mt-1",children:b}),d&&e.jsx("div",{className:"text-primary text-sm mt-1",children:"Processing image..."})]}),e.jsx("div",{className:"space-y-3",children:t.length===0?e.jsx("div",{className:"text-center text-muted-foreground py-6",children:"No todo items yet. Add one above!"}):t.map(l=>e.jsx(re,{item:l,onUpdate:a,onDelete:n},l.id))})]})}function ge(){const{id:t}=$(),s=M(),[a,n]=r.useState(null),[m,x]=r.useState(!0),[d,i]=r.useState(null),[b,f]=r.useState(!1),[p,c]=r.useState(!1);r.useEffect(()=>{if(!t){i("No sweep ID provided"),x(!1);return}const o=_(t,u=>{u?n(u):i("Sweep not found"),x(!1)});return()=>o()},[t]);const y=async(o,u)=>{if(t)try{await J(t,o,u)}catch(g){i(g instanceof Error?g.message:"Failed to add todo item")}},w=async(o,u)=>{if(t)try{await H(t,o,u)}catch(g){i(g instanceof Error?g.message:"Failed to update todo item")}},l=async o=>{if(t)try{await X(t,o)}catch(u){i(u instanceof Error?u.message:"Failed to delete todo item")}},h=()=>{navigator.clipboard.writeText(window.location.href),f(!0),setTimeout(()=>f(!1),2e3)},T=async()=>{if(t)try{c(!0),await K(t),c(!1)}catch(o){i(o instanceof Error?o.message:"Failed to extend sweep"),c(!1)}},I=()=>{s("/sweeps")},S=()=>{if(!a)return 0;const o=new Date,g=a.expiresAt.getTime()-o.getTime(),D=Math.ceil(g/(1e3*60*60*24));return Math.max(0,D)};if(m)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading sweep..."})});if(d||!a)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:[e.jsx("p",{className:"text-destructive mb-4",children:d||"Sweep not found"}),e.jsx(j,{onClick:()=>s("/"),children:"Go Home"})]});const E=S();return e.jsxs("div",{className:"container mx-auto py-6 px-4 max-w-3xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("div",{children:e.jsx(j,{variant:"outline",size:"sm",onClick:I,children:"‚Üê Back to Sweeps"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:h,children:b?"Copied!":"Copy Link"}),e.jsx(j,{variant:"outline",size:"sm",onClick:T,disabled:p,children:p?"Extending...":`Extend (${E} days left)`})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:a.title||"Untitled Sweep"}),e.jsxs("p",{className:"text-muted-foreground",children:["Expires on ",a.expiresAt.toLocaleDateString()," at ",a.expiresAt.toLocaleTimeString()]})]}),d&&e.jsx("div",{className:"bg-destructive/10 border border-destructive text-destructive px-4 py-3 rounded-md mb-6",children:d}),e.jsx(ie,{items:a.todos,onAddItem:y,onUpdateItem:w,onDeleteItem:l})]})}export{ge as SweepPage};
